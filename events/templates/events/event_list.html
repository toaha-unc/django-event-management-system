{% extends "base.html" %}
{% block title %}Events{% endblock %}
{% block content %}

<div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 sm:mb-8 gap-4">
    <h2 class="text-2xl sm:text-3xl font-extrabold text-blue-700">Events</h2>

    {% if user.is_authenticated %}
        {% if user.profile.is_admin or user.profile.is_organizer %}
        <a href="{% url 'event_create' %}" class="bg-blue-600 text-white px-4 sm:px-6 py-2 rounded-full font-bold shadow hover:bg-blue-700 transition text-sm sm:text-base">Add Event</a>
        {% endif %}
    {% endif %}
</div>

<form method="get" class="mb-6 sm:mb-8 flex flex-col sm:flex-row flex-wrap gap-3 sm:gap-2 items-start sm:items-center bg-white p-4 rounded-xl shadow">
    {% if categories %}
    <select name="category" class="border rounded px-3 py-2">
        <option value="">All Categories</option>
        {% for cat in categories %}
            <option value="{{ cat.id }}" {% if selected_category == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
        {% endfor %}
    </select>
    {% else %}
    <p class="text-gray-500 italic">No categories available.</p>
    {% endif %}

    <label class="text-gray-700 font-medium">From:</label>
    <input type="date" name="start_date" value="{{ start_date }}" class="border rounded px-3 py-2" />

    <label class="text-gray-700 font-medium">To:</label>
    <input type="date" name="end_date" value="{{ end_date }}" class="border rounded px-3 py-2" />

    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Search</button>
</form>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
                    {% for event in events %}
                <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition flex flex-col overflow-hidden">
                    {% if event.image %}
                        <div class="w-full h-48 sm:h-56 lg:h-64 overflow-hidden">
                            <img src="{{ event.image.url }}" alt="{{ event.name }}" class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
                        </div>
                    {% endif %}
                    <div class="p-4 sm:p-6 flex-1 flex flex-col">
                        <h2 class="text-xl sm:text-2xl lg:text-3xl font-extrabold text-blue-700 mb-2 leading-tight">
                            <a href="{% url 'event_detail' event.pk %}" class="hover:underline">{{ event.name }}</a>
                        </h2>

        <div class="flex flex-col sm:flex-row sm:items-center text-gray-500 text-sm mb-3 gap-2 sm:gap-4">
            <div class="inline-flex items-center gap-1">
                <svg class="w-4 h-4 sm:w-5 sm:h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span>{{ event.date }}</span>
            </div>
            <div class="inline-flex items-center gap-1">
                <svg class="w-4 h-4 sm:w-5 sm:h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>{{ event.time }}</span>
            </div>
        </div>

        <p class="text-gray-600 mb-2 text-sm sm:text-base"><span class="font-medium text-gray-700">Venue:</span><br>{{ event.location }}</p>
        <p class="text-gray-600 mb-2 text-sm sm:text-base"><span class="font-medium text-gray-700">Category:</span> {{ event.category.name }}</p>
        <p class="text-gray-700 mb-4 text-sm sm:text-base">{{ event.description }}</p>

        <p class="text-blue-700 font-semibold mb-2 text-sm sm:text-base">
            Participants:
            {% if event.rsvp_set.all %}
                {% for rsvp in event.rsvp_set.all %}
                    {{ rsvp.user.username }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            {% else %}
                <span class="text-gray-500">No Participants yet</span>
            {% endif %}
        </p>

        <p class="text-blue-700 font-semibold mb-2 text-sm sm:text-base">Total Participants: {{ event.rsvp_set.count }}</p>

        {% if user.is_authenticated %}
            {% if user.profile.is_admin or user.profile.is_organizer %}
            <div class="mt-auto flex flex-wrap gap-2">
                <a href="{% url 'event_update' event.pk %}" class="bg-blue-100 text-blue-700 px-3 sm:px-4 py-2 rounded-full font-semibold shadow hover:bg-blue-200 transition text-sm">
                    Edit
                </a>
                <a href="{% url 'event_delete' event.pk %}" class="bg-red-100 text-red-700 px-3 sm:px-4 py-2 rounded-full font-semibold shadow hover:bg-red-200 transition text-sm">
                    Delete
                </a>
            </div>
            {% endif %}
        {% endif %}
                    </div>
                </div>
    {% empty %}
    <p class="col-span-full text-center text-gray-500">No events found.</p>
    {% endfor %}
</div>

<div class="mt-8 sm:mt-12 text-center sm:text-right">
    <span class="font-semibold text-base sm:text-lg text-blue-700">Total Participants: {{ total_participants }}</span>
</div>

{% endblock %}
